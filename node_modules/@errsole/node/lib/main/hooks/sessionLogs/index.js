'use strict';var a0_0x330db3=a0_0x572d;(function(_0x146df6,_0x567c2a){var _0x4d9f04=a0_0x572d,_0x1a56e1=_0x146df6();while(!![]){try{var _0x72585=-parseInt(_0x4d9f04(0xca))/0x1*(-parseInt(_0x4d9f04(0x96))/0x2)+-parseInt(_0x4d9f04(0xb2))/0x3+parseInt(_0x4d9f04(0x9b))/0x4+-parseInt(_0x4d9f04(0xa1))/0x5+parseInt(_0x4d9f04(0xa2))/0x6*(-parseInt(_0x4d9f04(0xa4))/0x7)+-parseInt(_0x4d9f04(0xba))/0x8*(-parseInt(_0x4d9f04(0xa9))/0x9)+parseInt(_0x4d9f04(0xc3))/0xa*(parseInt(_0x4d9f04(0x97))/0xb);if(_0x72585===_0x567c2a)break;else _0x1a56e1['push'](_0x1a56e1['shift']());}catch(_0xbea769){_0x1a56e1['push'](_0x1a56e1['shift']());}}}(a0_0x395c,0x3d30c));function a0_0x572d(_0xa3e1a3,_0xb5f4bb){var _0x395ca1=a0_0x395c();return a0_0x572d=function(_0x572d0b,_0x3f0d41){_0x572d0b=_0x572d0b-0x94;var _0x4d1945=_0x395ca1[_0x572d0b];return _0x4d1945;},a0_0x572d(_0xa3e1a3,_0xb5f4bb);}const FS=require('fs'),Path=require('path'),{v4:uuidv4}=require('uuid');var cron=require('node-cron'),Server=require('../../connection/server'),Events=require(a0_0x330db3(0x95)),appConfig=require(a0_0x330db3(0xb1)),SessionLogs={};function getSessionLogData(_0x17aef7){return new Promise(function(_0xd76f5,_0x520b0b){var _0x2a8211=a0_0x572d,_0x56d06b=Path[_0x2a8211(0xc9)](__dirname,_0x2a8211(0xa7)),_0x4b95f7=_0x56d06b+'/'+_0x17aef7+'_'+getRoundTime(0x1),_0x59ed0a=_0x56d06b+'/'+_0x17aef7+'_'+getRoundTime(0x2),_0x46b967=_0x56d06b+'/'+_0x17aef7+'_'+getRoundTime(0x3),_0x51415f=[];try{_0x3a110b='['+(_0x3a110b=FS[_0x2a8211(0xb7)](_0x4b95f7,{'encoding':_0x2a8211(0xbb),'flag':'r'}))[_0x2a8211(0xc7)](0x0,-0x1)+']',_0x3a110b=JSON[_0x2a8211(0xa0)](_0x3a110b),(_0x51415f=_0x51415f['concat'](_0x3a110b))['length']>=0x14&&(_0x51415f[_0x2a8211(0x9c)]((_0x314a16,_0x487ea8)=>_0x487ea8[_0x2a8211(0xb4)]>_0x314a16[_0x2a8211(0xb4)]?0x1:_0x314a16['timestamp']>_0x487ea8[_0x2a8211(0xb4)]?-0x1:0x0),_0xd76f5(_0x51415f=_0x51415f[_0x2a8211(0xc7)](0x0,0x14)));}catch(_0x19718f){}try{_0x3a110b='['+(_0x3a110b=FS[_0x2a8211(0xb7)](_0x59ed0a,{'encoding':_0x2a8211(0xbb),'flag':'r'}))[_0x2a8211(0xc7)](0x0,-0x1)+']',_0x3a110b=JSON[_0x2a8211(0xa0)](_0x3a110b),(_0x51415f=_0x51415f[_0x2a8211(0xad)](_0x3a110b))[_0x2a8211(0xa5)]>=0x14&&(_0x51415f['sort']((_0x48c51f,_0x3d6eef)=>_0x3d6eef[_0x2a8211(0xb4)]>_0x48c51f[_0x2a8211(0xb4)]?0x1:_0x48c51f[_0x2a8211(0xb4)]>_0x3d6eef['timestamp']?-0x1:0x0),_0xd76f5(_0x51415f=_0x51415f[_0x2a8211(0xc7)](0x0,0x14)));}catch(_0x319956){}try{var _0x3a110b;_0x3a110b='['+(_0x3a110b=FS['readFileSync'](_0x46b967,{'encoding':_0x2a8211(0xbb),'flag':'r'}))[_0x2a8211(0xc7)](0x0,-0x1)+']',_0x3a110b=JSON[_0x2a8211(0xa0)](_0x3a110b),(_0x51415f=_0x51415f[_0x2a8211(0xad)](_0x3a110b))[_0x2a8211(0xa5)]>=0x14&&(_0x51415f[_0x2a8211(0x9c)]((_0x289d54,_0x5b7152)=>_0x5b7152[_0x2a8211(0xb4)]>_0x289d54[_0x2a8211(0xb4)]?0x1:_0x289d54[_0x2a8211(0xb4)]>_0x5b7152[_0x2a8211(0xb4)]?-0x1:0x0),_0xd76f5(_0x51415f=_0x51415f[_0x2a8211(0xc7)](0x0,0x14)));}catch(_0x1af7c7){}_0x51415f[_0x2a8211(0x9c)]((_0x17de62,_0x42deb4)=>_0x42deb4[_0x2a8211(0xb4)]>_0x17de62[_0x2a8211(0xb4)]?0x1:_0x17de62[_0x2a8211(0xb4)]>_0x42deb4[_0x2a8211(0xb4)]?-0x1:0x0),_0xd76f5(_0x51415f=_0x51415f[_0x2a8211(0xc7)](0x0,0x14));});}SessionLogs[a0_0x330db3(0xc2)]=function(){Events['on'](Events['ROUTER_CONNECTION_ESTABLISHED'],function(){var _0x3950a0=a0_0x572d;appConfig[_0x3950a0(0xbc)]()&&(Server[_0x3950a0(0xa8)](Server[_0x3950a0(0x99)],async function(_0x3fc32d,_0x55ab92){var _0x22713c=_0x3950a0,_0x41945d=_0x55ab92[_0x22713c(0xaa)];if(!_0x41945d)return null;try{return await getSessionLogData(_0x41945d);}catch(_0x537c58){return console[_0x22713c(0xbe)](_0x537c58),null;}},{'invoke':appConfig[_0x3950a0(0xc4)]()}),tmpFolderHandler(),clearSessionLogData(),cron[_0x3950a0(0xbd)](_0x3950a0(0xc5),()=>{clearSessionLogData();}));});},SessionLogs['addHTTPResponseLog']=function(_0x2159fb,_0x53e890,_0x4f47ce){var _0x57f897=a0_0x330db3;try{var _0x4e8be8='';_0x4f47ce[_0x57f897(0xbe)]&&_0x4f47ce['error']['message']?_0x4e8be8=_0x4f47ce[_0x57f897(0xbe)][_0x57f897(0xb5)]:_0x4f47ce['response']&&_0x4f47ce[_0x57f897(0xab)]['statusMessage']&&(_0x4e8be8=_0x4f47ce[_0x57f897(0xab)][_0x57f897(0xc6)]),_0x4f47ce[_0x57f897(0xb8)]&&(delete _0x4f47ce['request'][_0x57f897(0xb0)],delete _0x4f47ce[_0x57f897(0xb8)][_0x57f897(0x9e)]);var _0x544bc1={'id':uuidv4(),'timestamp':new Date()['getTime'](),'type':_0x53e890,'method':_0x4f47ce[_0x57f897(0xb8)][_0x57f897(0x94)],'path':_0x4f47ce[_0x57f897(0xb8)][_0x57f897(0xc0)],'routePath':_0x4f47ce[_0x57f897(0xb8)][_0x57f897(0x9f)],'statusCode':_0x4f47ce[_0x57f897(0xab)][_0x57f897(0xb6)],'message':_0x4e8be8,'data':_0x4f47ce};addSessionLog(_0x2159fb,_0x544bc1);}catch(_0x310e97){console[_0x57f897(0xbe)](_0x310e97);}};var tmpFolderHandler=function(){var _0x46b56a=a0_0x330db3,_0x3a4036=Path[_0x46b56a(0xc9)](__dirname,'../tmp');FS[_0x46b56a(0xac)](_0x3a4036)||FS[_0x46b56a(0xae)](_0x3a4036);},addSessionLog=function(_0x42962f,_0x4056d0){var _0x783282=a0_0x330db3,_0xdb350b=Path[_0x783282(0xc9)](__dirname,'../tmp');if(!FS[_0x783282(0xac)](_0xdb350b))return!0x1;var _0x55223f=_0xdb350b+'/'+_0x42962f+'_'+getRoundTime();try{var _0xb6e8a3=FS[_0x783282(0x9a)](_0x55223f,{'flags':'a'});_0xb6e8a3[_0x783282(0xc8)](JSON[_0x783282(0xb9)](_0x4056d0)+','),_0xb6e8a3[_0x783282(0x9d)]();}catch(_0x286298){console[_0x783282(0xbe)](_0x286298);}},clearSessionLogData=function(){var _0x3ddc1f=a0_0x330db3,_0x268709=Path[_0x3ddc1f(0xc9)](__dirname,_0x3ddc1f(0xa7));if(!FS[_0x3ddc1f(0xac)](_0x268709))return!0x1;try{var _0x8115b1=FS[_0x3ddc1f(0xa3)](_0x268709);for(var _0x21d0e1 in _0x8115b1){var _0x2587c3=_0x268709+'/'+_0x8115b1[_0x21d0e1];isFileExpired(_0x2587c3)&&FS['unlinkSync'](_0x2587c3);}}catch(_0x391868){console[_0x3ddc1f(0xbe)](_0x391868);}},isFileExpired=function(_0x48d90b){var _0x159e71=a0_0x330db3;try{const _0x4a61fb=FS[_0x159e71(0xbf)](_0x48d90b);var _0x205610=new Date()-new Date(_0x4a61fb['mtime']);return Math[_0x159e71(0x98)](_0x205610/0xea60)>=appConfig[_0x159e71(0xaf)]();}catch(_0x306900){console['error'](_0x306900);}},getRoundTime=function(_0x4a614=0x1){var _0x5ba01f=a0_0x330db3,_0x481570=0xea60*appConfig[_0x5ba01f(0xc1)](),_0x16bcdf=new Date()[_0x5ba01f(0xa6)]();return Math[_0x5ba01f(0xb3)](_0x16bcdf/_0x481570)*_0x481570-_0x481570*_0x4a614;};SessionLogs['initialize'](),module['exports']=SessionLogs;function a0_0x395c(){var _0x898399=['register','2489715sNDQbu','errsoleSessionId','response','existsSync','concat','mkdirSync','getLogFileTTL','file','../../../config','1337583kbUowv','round','timestamp','message','statusCode','readFileSync','request','stringify','8CqYJyF','utf8','getEnableSessionLogs','schedule','error','statSync','path','getLogFileRoundTime','initialize','1740630WXQYfh','getInvokeType','10\x20*\x20*\x20*\x20*','statusMessage','slice','write','resolve','4EUXWDp','method','../../eventCapture/events','239576OtNdkj','11pQGOYJ','floor','GET_SESSION_LOG_DATA','createWriteStream','690272WnrYym','sort','end','files','routePath','parse','432085zpfoyC','912DYzkLu','readdirSync','14714WvbjIg','length','getTime','../tmp'];a0_0x395c=function(){return _0x898399;};return a0_0x395c();}