'use strict';var a0_0x516a61=a0_0x189a;(function(_0x376334,_0x6527f3){var _0x4b813f=a0_0x189a,_0x1cd7d1=_0x376334();while(!![]){try{var _0x2cb817=parseInt(_0x4b813f(0xbc))/0x1+-parseInt(_0x4b813f(0xd2))/0x2*(-parseInt(_0x4b813f(0xf4))/0x3)+-parseInt(_0x4b813f(0xc8))/0x4+parseInt(_0x4b813f(0xde))/0x5+-parseInt(_0x4b813f(0xaf))/0x6+parseInt(_0x4b813f(0xcf))/0x7+parseInt(_0x4b813f(0xee))/0x8;if(_0x2cb817===_0x6527f3)break;else _0x1cd7d1['push'](_0x1cd7d1['shift']());}catch(_0x33e09e){_0x1cd7d1['push'](_0x1cd7d1['shift']());}}}(a0_0x3176,0xa92e3));function a0_0x3176(){var _0x2fc16b=['3036820LIWUvm','errsole','uuid','statusCodes','NODE_FRAMEWORK_KEYS','method','routePath','addHTTPResponseLog','CAPTURE_STDERR_URI','indexOf','REMOVE_HTTP_REQUEST_LOG','UNCAUGHT_EXCEPTION','HTTP_RESPONSE_SENT','error','getEnableSessionLogs','ROUTER_CONNECTION_ESTABLISHED','3959200mQBZzf','callSocketio','value','then','.\x20Please\x20report\x20the\x20issue\x20at\x20https://www.errsole.com/support','responseTime','3pkzmwu','../hooks/slowRequests','Errsole\x20Internal\x20Error:\x20','call','ADD_STDERR_LOG','responseKeys','assign','node','../hooks/process','../../config','getFrameworkName','code','exports','errorKeys','split','getResponseTimeThreshold','function','toLowerCase','ADD_HTTP_REQUEST_LOG','8234070kMDYSo','deleteKeys','keys','sessionKeys','exitProcess','message','HTTP_EXCEPTION_URI','filter','requestKeys','object','forEach','isHTTPException','path','124288VpTONe','path-to-regexp','session','getPendingHTTPRequests','getTime','toString','length','checkSlowHTTPRequestExist','resolve','apply','stack','statusCode','1166272YSzZqj','subscribe','versions','jsonpath','connected','ADD_STDOUT_LOG','GET_EVENT_CAPTURE_CRITERIA_URI','4943470fAdFqH','statusMessage','request','848228fckKxX','getHeaders','http','uncaught','EVENT_CAPTURE_CRITERIA_UPDATED_URI','$.response._headers','socketio','getSkipRoutes','./events','data','response','catch'];a0_0x3176=function(){return _0x2fc16b;};return a0_0x3176();}var Events=require(a0_0x516a61(0xda)),Server=require('../connection/server'),ProcessHook=require(a0_0x516a61(0xa4)),SessionLogs=require('../hooks/sessionLogs'),SlowRequests=require(a0_0x516a61(0xf5)),jp=require(a0_0x516a61(0xcb));const {v4:uuidv4}=require(a0_0x516a61(0xe0)),{match:match}=require(a0_0x516a61(0xbd));var appConfig=require(a0_0x516a61(0xa5)),pendingHTTPRequests=appConfig[a0_0x516a61(0xbf)](),EventCapturer={},DataExtractionSchema={},CaptureCriteria={};function a0_0x189a(_0x589033,_0x95780e){var _0x31764c=a0_0x3176();return a0_0x189a=function(_0x189a06,_0x2bbd33){_0x189a06=_0x189a06-0xa3;var _0x1ef87d=_0x31764c[_0x189a06];return _0x1ef87d;},a0_0x189a(_0x589033,_0x95780e);}async function uncaughtExceptionHandler(_0x1fec77){var _0x5325f6=a0_0x516a61,_0x836c75=appConfig[_0x5325f6(0xa6)]();if(!_0x1fec77||!_0x1fec77[_0x5325f6(0xeb)])return ProcessHook[_0x5325f6(0xb3)](0x1),!0x1;var _0xd39341={'error':{'code':_0x1fec77[_0x5325f6(0xeb)][_0x5325f6(0xa7)],'message':_0x1fec77[_0x5325f6(0xeb)][_0x5325f6(0xb4)],'stack':_0x1fec77[_0x5325f6(0xeb)][_0x5325f6(0xc6)]}};_0x836c75&&''!==_0x836c75&&(_0xd39341['logData']=await getPendingHTTPRequestsData()),Server[_0x5325f6(0xf7)](Server['UNCAUGHT_EXCEPTION_HANDLER_URI'],[],_0xd39341)[_0x5325f6(0xf1)](function(){ProcessHook['exitProcess'](0x1);})[_0x5325f6(0xdd)](function(_0x21df5a){ProcessHook['exitProcess'](0x1);});}function addHttpRequestLogHandler(_0x1e35db){var _0x18b50b=a0_0x516a61;if(!_0x1e35db||!_0x1e35db[_0x18b50b(0xdf)])return!0x1;var _0x405db3=_0x1e35db[_0x18b50b(0xdf)]['id']||uuidv4();pendingHTTPRequests[_0x405db3]=_0x1e35db;}function removeHttpRequestLogHandler(_0x13bddd){var _0x66a706=a0_0x516a61;if(!_0x13bddd)return!0x1;var _0x160a08=_0x13bddd[_0x66a706(0xdf)]['id'];_0x160a08&&delete pendingHTTPRequests[_0x160a08];}async function getPendingHTTPRequestsData(){var _0x1c9e73=a0_0x516a61;return getServerSchema()[_0x1c9e73(0xf1)](function(_0x1077c3){var _0x1db061=_0x1c9e73,_0x33b9ec={};if(!_0x1077c3)return{};for(var _0x33b207 in pendingHTTPRequests){var _0x2f8cd2={'request':pendingHTTPRequests[_0x33b207]},_0x3e1e94=extractData(_0x2f8cd2,_0x1077c3[_0x1db061(0xb7)],_0x1077c3[_0x1db061(0xb0)]);if(appConfig['getSkipRoutes']()['length']>0x0)var _0x19a05d=verifySkipRoute(_0x3e1e94[_0x1db061(0xe3)],_0x3e1e94[_0x1db061(0xbb)]);else _0x19a05d=!0x1;if(appConfig['getFilterRoutes']()[_0x1db061(0xc2)]>0x0)var _0x106022=verifyFilterRoute(_0x3e1e94['method'],_0x3e1e94[_0x1db061(0xbb)]);else _0x106022=!0x1;if(_0x3e1e94&&!_0x19a05d){var _0x461e95=extractData(_0x2f8cd2,_0x1077c3[_0x1db061(0xb2)],_0x1077c3[_0x1db061(0xb0)]);try{var _0x1e0310={'id':uuidv4(),'timestamp':new Date()[_0x1db061(0xc0)](),'type':_0x1db061(0xd5),'path':_0x3e1e94[_0x1db061(0xbb)],'routePath':_0x3e1e94[_0x1db061(0xe4)],'method':_0x3e1e94['method'],'data':{}};if(_0x106022){var _0x4abab6={'method':_0x3e1e94[_0x1db061(0xe3)],'path':_0x3e1e94[_0x1db061(0xbb)],'routePath':_0x3e1e94[_0x1db061(0xe4)],'isRequestFiltered':!0x0};_0x1e0310[_0x1db061(0xdb)]['request']=_0x4abab6,_0x1e0310['data']['session']=_0x461e95;}else _0x1e0310[_0x1db061(0xdb)][_0x1db061(0xd1)]=_0x3e1e94,_0x1e0310[_0x1db061(0xdb)][_0x1db061(0xbe)]=_0x461e95;_0x33b9ec[_0x33b207]=_0x1e0310;}catch(_0x448e2a){console[_0x1db061(0xeb)](_0x448e2a);}}}return Object[_0x1db061(0xb1)](_0x33b9ec)['map'](_0x372483=>_0x33b9ec[_0x372483]);});}function httpResponseHandler(_0x46d7f0){var _0x239462=a0_0x516a61;if(!_0x46d7f0||!_0x46d7f0[_0x239462(0xdc)])return!0x1;var _0x34f015=(_0x46d7f0[_0x239462(0xdc)]||{})[_0x239462(0xc7)]||0x0,_0x27efe7=appConfig[_0x239462(0xab)]()||0x0,_0x2fd17a=_0x46d7f0[_0x239462(0xd1)]?.[_0x239462(0xdf)]?.[_0x239462(0xf3)]||0x0;if(_0x34f015<0x190&&(parseInt(_0x2fd17a)<parseInt(_0x27efe7)||0x0===parseInt(_0x27efe7)))return!0x1;getServerSchema()['then'](function(_0x195830){var _0x4171ba=_0x239462;if(!_0x195830)return!0x1;var _0x2a37b8=extractData(_0x46d7f0,_0x195830['requestKeys'],_0x195830[_0x4171ba(0xb0)]);if(appConfig['getSkipRoutes']()[_0x4171ba(0xc2)]>0x0&&verifySkipRoute(_0x2a37b8[_0x4171ba(0xe3)],_0x2a37b8[_0x4171ba(0xbb)]))return!0x1;var _0x53024c=appConfig[_0x4171ba(0xec)]();if(_0x34f015<0x190&&(parseInt(_0x57c19c)>=parseInt(_0x1634f8)||0x0!==parseInt(_0x1634f8))&&!0x1===_0x53024c&&0x0!==_0x57c19c){var _0x57c19c=_0x46d7f0[_0x4171ba(0xd1)]?.[_0x4171ba(0xdf)]?.['responseTime']||0x0;if(SlowRequests[_0x4171ba(0xc3)](_0x2a37b8,_0x57c19c))return!0x1;}if(appConfig['getFilterRoutes']()['length']>0x0)var _0x110922=verifyFilterRoute(_0x2a37b8['method'],_0x2a37b8[_0x4171ba(0xbb)]);else _0x110922=!0x1;var _0x445a33=extractData(_0x46d7f0,_0x195830[_0x4171ba(0xf9)],_0x195830[_0x4171ba(0xb0)]),_0x1e9910=extractData(_0x46d7f0,_0x195830[_0x4171ba(0xb2)],_0x195830[_0x4171ba(0xb0)]),_0x305f3a=extractData(_0x46d7f0,_0x195830[_0x4171ba(0xa9)],_0x195830[_0x4171ba(0xb0)]),_0x27f64d=matchCriteria(_0x2a37b8,_0x445a33),_0x8e0a37={'request':_0x2a37b8,'response':_0x445a33,'session':_0x1e9910,'error':_0x305f3a};if(_0x110922)var _0x32217e={'request':{'method':_0x8e0a37[_0x4171ba(0xd1)][_0x4171ba(0xe3)],'path':_0x8e0a37[_0x4171ba(0xd1)]['path'],'routePath':_0x8e0a37[_0x4171ba(0xd1)][_0x4171ba(0xe4)],'isRequestFiltered':!0x0},'response':{'statusCode':_0x8e0a37['response'][_0x4171ba(0xc7)],'statusMessage':_0x8e0a37[_0x4171ba(0xdc)][_0x4171ba(0xd0)]},'session':_0x1e9910,'error':_0x305f3a};else _0x32217e=null;_0x27f64d[_0x4171ba(0xc2)]>0x0&&_0x27f64d[_0x4171ba(0xb9)](function(_0xcfd0f9){var _0x5c9dcf=_0x4171ba;_0xcfd0f9[_0x5c9dcf(0xba)]&&Server['call'](Server[_0x5c9dcf(0xb5)],[],_0x32217e||_0x8e0a37)[_0x5c9dcf(0xdd)](console[_0x5c9dcf(0xeb)]);});var _0x2f6b0a=_0x46d7f0[_0x4171ba(0xd1)][_0x4171ba(0xdf)]['errsoleSessionId'];_0x53024c&&SessionLogs[_0x4171ba(0xe5)](_0x2f6b0a,_0x4171ba(0xd4),_0x32217e||_0x8e0a37);var _0x1634f8=appConfig[_0x4171ba(0xab)]();_0x57c19c=_0x46d7f0[_0x4171ba(0xd1)]['errsole']['responseTime'],parseInt(_0x1634f8)<parseInt(_0x57c19c)&&SlowRequests['addSlowHTTPRequest'](_0x32217e||_0x8e0a37,parseInt(_0x57c19c));});}function matchCriteria(_0x34181a,_0x31d117){var _0x353e16=a0_0x516a61,_0x1321b0=[];return CaptureCriteria[_0x353e16(0xe1)]&&CaptureCriteria[_0x353e16(0xe1)][_0x353e16(0xe7)](_0x31d117[_0x353e16(0xc7)])>=0x0&&_0x1321b0['push']({'isHTTPException':!0x0}),_0x1321b0;}function preprocessEventData(_0x1dd1ae,_0x2946b2){var _0x4909da=a0_0x516a61;Object[_0x4909da(0xb1)](_0x2946b2)['forEach'](_0x2d1ddc=>{var _0x4d8c9d=_0x4909da;_0x4d8c9d(0xd7)===_0x2946b2[_0x2d1ddc]&&(_0x2946b2[_0x2d1ddc]='$.response.headerData',_0x1dd1ae['response']&&_0x4d8c9d(0xac)==typeof _0x1dd1ae[_0x4d8c9d(0xdc)][_0x4d8c9d(0xd3)]&&(_0x1dd1ae[_0x4d8c9d(0xdc)]['headerData']=_0x1dd1ae[_0x4d8c9d(0xdc)]['getHeaders']()));});}function extractData(_0x368e3e,_0xf3f89,_0x127dee){var _0xfa3387=a0_0x516a61,_0x34d580=Object[_0xfa3387(0xfa)]({},_0x368e3e);_0x368e3e={};if(preprocessEventData(_0x34d580,_0xf3f89),_0xfa3387(0xb8)!=typeof _0xf3f89||'object'!=typeof _0x127dee)return null;try{for(var _0x29436e in _0x127dee){var _0x32677d=_0x127dee[_0x29436e];jp[_0xfa3387(0xc5)](_0x34d580,_0x32677d,function(_0x1500a5){return null;});}}catch(_0x3c8470){console['error'](_0x3c8470);}try{for(var _0x29436e in _0xf3f89){_0x32677d=_0xf3f89[_0x29436e];var _0x2cd03b=jp[_0xfa3387(0xf0)](_0x34d580,_0x32677d);_0x2cd03b?_0x368e3e[_0x29436e]=_0x2cd03b:_0x2cd03b=null;}}catch(_0xd6ee00){console[_0xfa3387(0xeb)](_0xd6ee00);}return _0x368e3e;}function getEventCaptureCriteria(){var _0x22f0da=a0_0x516a61,_0x5d1506=appConfig[_0x22f0da(0xa6)]();if(!_0x5d1506||''==_0x5d1506)return!0x1;Server[_0x22f0da(0xf7)](Server[_0x22f0da(0xce)])[_0x22f0da(0xf1)](function(_0x22e8bb){var _0xff5300=_0x22f0da;Object[_0xff5300(0xfa)](CaptureCriteria,_0x22e8bb),Server[_0xff5300(0xc9)](Server[_0xff5300(0xd6)],function(_0xa670be,_0x133706){var _0x3b6991=_0xff5300;Object[_0x3b6991(0xfa)](CaptureCriteria,_0x133706);}),setInterval(function(){updateEventCaptureCriteria();},0x1d4c0),getServerSchema();})['catch'](function(_0x14408a){var _0x58a68f=_0x22f0da;console[_0x58a68f(0xeb)](_0x14408a);});}function updateEventCaptureCriteria(){var _0x584452=a0_0x516a61;Server[_0x584452(0xf7)](Server['GET_EVENT_CAPTURE_CRITERIA_URI'])[_0x584452(0xf1)](function(_0x28fe1c){Object['assign'](CaptureCriteria,_0x28fe1c);})[_0x584452(0xdd)](function(_0x45abd8){var _0x8571f3=_0x584452;console[_0x8571f3(0xeb)](_0x45abd8);});}function getServerSchema(){var _0x46b70f=a0_0x516a61,_0x31ff1b=appConfig[_0x46b70f(0xa6)]();if(DataExtractionSchema[_0x31ff1b])return Promise[_0x46b70f(0xc4)](DataExtractionSchema[_0x31ff1b]);var _0xce24cc={'frameworkName':_0x31ff1b,'frameworkVersion':'','nodeVersion':process[_0x46b70f(0xca)][_0x46b70f(0xa3)]};return Server[_0x46b70f(0xf7)](Server[_0x46b70f(0xe2)],[],_0xce24cc)['then'](function(_0x3c1be4){var _0xfe80c9=_0x46b70f;if(0x0!=Object[_0xfe80c9(0xb1)](_0x3c1be4)[_0xfe80c9(0xc2)])return appConfig['setNodeFrameworkKeys'](_0x31ff1b,_0x3c1be4),DataExtractionSchema[_0x31ff1b]=_0x3c1be4,_0x3c1be4;console[_0xfe80c9(0xeb)](new Error('Errsole\x20Internal\x20Error:\x20Failed\x20to\x20get\x20the\x20framework\x20schema.\x20Please\x20report\x20the\x20issue\x20at\x20https://www.errsole.com/support'));})[_0x46b70f(0xdd)](function(_0xf8bd64){var _0x269e1e=_0x46b70f;console[_0x269e1e(0xeb)](new Error(_0x269e1e(0xf6)+(_0xf8bd64['message']||_0xf8bd64[_0x269e1e(0xc1)]())+_0x269e1e(0xf2)));});}function verifyFilterRoute(_0x42d4be,_0x3c8b76){var _0x2304ca=a0_0x516a61,_0x390db4=!0x1,_0x2fdac7=appConfig['getFilterRoutes']()[_0x2304ca(0xb6)](_0xef4719=>_0xef4719[_0x2304ca(0xe3)][_0x2304ca(0xad)]()==_0x42d4be[_0x2304ca(0xad)]());for(var _0x2e91e6 in _0x2fdac7){var _0x32aa10=_0x2fdac7[_0x2e91e6]['path'];if(_0x32aa10&&_0x3c8b76){_0x3c8b76=_0x3c8b76['split']('?')[0x0];try{if(_0x390db4=match(_0x32aa10[_0x2304ca(0xad)](),{'decode':decodeURIComponent})(_0x3c8b76['toLowerCase']()))break;}catch(_0x4cce0b){console[_0x2304ca(0xeb)](_0x4cce0b);}}}return _0x390db4;}function verifySkipRoute(_0x1ddbf0,_0x3c2b2c){var _0x23dbed=a0_0x516a61,_0x450029=!0x1,_0x1281f3=appConfig[_0x23dbed(0xd9)]()[_0x23dbed(0xb6)](_0x3bf462=>_0x3bf462[_0x23dbed(0xe3)][_0x23dbed(0xad)]()==_0x1ddbf0[_0x23dbed(0xad)]());for(var _0x59c258 in _0x1281f3){var _0x236d34=_0x1281f3[_0x59c258][_0x23dbed(0xbb)];if(_0x236d34&&_0x3c2b2c){_0x3c2b2c=_0x3c2b2c[_0x23dbed(0xaa)]('?')[0x0];try{if(_0x450029=match(_0x236d34[_0x23dbed(0xad)](),{'decode':decodeURIComponent})(_0x3c2b2c[_0x23dbed(0xad)]()))break;}catch(_0x79e1c0){console[_0x23dbed(0xeb)](_0x79e1c0);}}}return _0x450029;}function addStdoutHandler(_0x494d06){var _0x88fa0e=a0_0x516a61;Server[_0x88fa0e(0xd8)]&&Server[_0x88fa0e(0xd8)][_0x88fa0e(0xcc)]&&Server[_0x88fa0e(0xef)](Server['CAPTURE_STDOUT_URI'],_0x494d06);}function addStderrHandler(_0x2ca372){var _0x227303=a0_0x516a61;Server[_0x227303(0xd8)]&&Server['socketio']['connected']&&Server[_0x227303(0xef)](Server[_0x227303(0xe6)],_0x2ca372);}EventCapturer['initialize']=function(){var _0x2e2e46=a0_0x516a61;Events['on'](Events[_0x2e2e46(0xe9)],uncaughtExceptionHandler),Events['on'](Events[_0x2e2e46(0xae)],addHttpRequestLogHandler),Events['on'](Events[_0x2e2e46(0xe8)],removeHttpRequestLogHandler),Events['on'](Events[_0x2e2e46(0xea)],httpResponseHandler),Events['on'](Events[_0x2e2e46(0xed)],getEventCaptureCriteria),Events['on'](Events[_0x2e2e46(0xcd)],addStdoutHandler),Events['on'](Events[_0x2e2e46(0xf8)],addStderrHandler);},module[a0_0x516a61(0xa8)]=EventCapturer;