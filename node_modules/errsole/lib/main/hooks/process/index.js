'use strict'

var Events = require('../../eventCapture/events');
var appConfig = require('../../../config');

var ProcessHook = {};

ProcessHook.initialize = function() {
  handleUncaughtExceptions();
}

ProcessHook.exitProcess = function(code = 1) {
  var exitOnExceptionStatus = appConfig.getExitOnExceptionStatus();
  if(exitOnExceptionStatus) {
    process.exit(code);
  }
}

function handleUncaughtExceptions() {
  process.on('uncaughtException', function(err) {
    console.error(err);
    var payload = {
      error: err
    };
    Events.emit(Events.UNCAUGHT_EXCEPTION, payload);
  });
}

ProcessHook.packages = [];

module.exports = ProcessHook;
